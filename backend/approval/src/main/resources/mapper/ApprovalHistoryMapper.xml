<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.approval.project.mapper.ApprovalHistoryMapper">
	<select id="getApprovalHistory" resultType="com.approval.project.model.ApprovalHistoryResponseDTO">
		SELECT ah.his_num AS hisNum
			 , ah.approval_num AS approvalNum
			 , ah.proc_id AS procId
			 , (SELECT emp_name FROM approval_emp WHERE user_id = ah.proc_id) AS procName
			 , ah.position_cd AS positionCd
			 , (SELECT position_name FROM positions WHERE position_cd = ah.position_cd) AS positionName
			 , ah.status_code AS statusCode
			 , (SELECT status_name FROM approval_status WHERE status_code = ah.status_code) AS statusName
			 , ah.his_reg_date AS hisRegDate
		  FROM approval_history ah
		 WHERE ah.approval_num = #{num}
	</select>
	
	<insert id="saveApprovalHistory" parameterType="com.approval.project.model.ApprovalSaveRequestDTO">
		INSERT INTO approval_history (
			approval_num
		  , proc_id
		  , position_cd
		  , status_code
		  , his_reg_date	
		) VALUES (
			#{num}
		  , #{writerId}
		  , #{positionCd}
		  , #{statusCode}
		  , NOW()
		)
	</insert>
</mapper>